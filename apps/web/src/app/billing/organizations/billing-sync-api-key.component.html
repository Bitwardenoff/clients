<form [formGroup]="formGroup" [bitSubmit]="submit">
  <bit-dialog>
    <h1 bitDialogTitle>
      {{ (hasBillingToken ? "viewBillingSyncToken" : "generateBillingSyncToken") | i18n }}
    </h1>
    <div bitDialogContent>
      <app-user-verification formControlName="verification" *ngIf="!clientSecret">
      </app-user-verification>

      <ng-container *ngIf="clientSecret && showRotateScreen">
        <p>{{ "rotateBillingSyncTokenTitle" | i18n }}</p>
        <bit-callout type="warning">
          {{ "rotateBillingSyncTokenWarning" | i18n }}
        </bit-callout>
      </ng-container>

      <div *ngIf="clientSecret && !showRotateScreen">
        <p>{{ "copyPasteBillingSync" | i18n }}</p>
        <label for="clientSecret">{{ "billingSyncKey" | i18n }}</label>
        <div class="input-group">
          <input
            id="clientSecret"
            class="form-control text-monospace"
            type="text"
            [(ngModel)]="clientSecret"
            [ngModelOptions]="{ standalone: true }"
            name="clientSecret"
            disabled
          />
          <div class="input-group-append">
            <button
              type="button"
              class="btn btn-outline-secondary"
              (click)="copy()"
              [appA11yTitle]="'copy' | i18n"
            >
              <i class="bwi bwi-lg bwi-clone" aria-hidden="true"></i>
            </button>
          </div>
        </div>
        <div class="small text-muted mt-2" *ngIf="showLastSyncText">
          <b class="font-weight-semibold">{{ "lastSync" | i18n }}:</b>
          {{ lastSyncDate | date : "medium" }}
        </div>
        <div class="small text-danger mt-2" *ngIf="showAwaitingSyncText">
          <i class="bwi bwi-error"></i>
          {{
            (daysBetween === 1 ? "awaitingSyncSingular" : "awaitingSyncPlural") | i18n : daysBetween
          }}
        </div>
      </div>
    </div>
    <ng-container bitDialogFooter>
      <button
        type="submit"
        class="btn btn-primary btn-submit"
        [disabled]="loading"
        *ngIf="!clientSecret || showRotateScreen"
      >
        <i class="bwi bwi-spinner bwi-spin" title="{{ 'loading' | i18n }}" *ngIf="loading"></i>
        <span>
          {{ submitButtonText }}
        </span>
      </button>
      <button
        bitButton
        bitDialogClose
        buttonType="secondary"
        type="button"
        *ngIf="!showRotateScreen"
      >
        {{ "close" | i18n }}
      </button>
      <button
        bitButton
        buttonType="secondary"
        type="button"
        *ngIf="showRotateScreen"
        (click)="cancelRotate()"
      >
        {{ "cancel" | i18n }}
      </button>
      <button
        bitButton
        buttonType="secondary"
        type="button"
        *ngIf="clientSecret && !showRotateScreen"
        (click)="rotateToken()"
      >
        {{ "rotateToken" | i18n }}
      </button>
    </ng-container>
  </bit-dialog>
</form>
