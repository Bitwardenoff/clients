<form [formGroup]="formGroup" [bitSubmit]="submit">
  <bit-dialog dialogSize="large">
    <span bitDialogTitle>
      {{ "assignToCollections" | i18n }}
      <span class="tw-text-sm tw-normal-case tw-text-muted">
        {{ pluralize(editableItemCount, "item", "items") }}
      </span>
    </span>

    <div bitDialogContent>
      <p>{{ "bulkCollectionAssignmentDialogDescription" | i18n }}</p>

      <br />

      <p *ngIf="readonlyItemCount > 0">
        {{ "bulkCollectionAssignmentWarning" | i18n: totalItemCount : readonlyItemCount }}
      </p>

      <p *ngIf="personalItemsCount > 0">
        {{
          orgName
            ? ("personalItemsWithOrgTransferWarning"
              | i18n: pluralize(personalItemsCount, "item", "items") : orgName)
            : ("personalItemsTransferWarning"
              | i18n: pluralize(personalItemsCount, "item", "items"))
        }}
      </p>

      <div class="tw-flex" *ngIf="showOrgSelector">
        <bit-form-field class="tw-grow">
          <bit-label>{{ "moveToOrganization" | i18n }}</bit-label>
          <bit-select bitInput formControlName="selectedOrg">
            <bit-option
              *ngFor="let org of organizations$ | async"
              icon="bwi-business"
              [value]="org.id"
              [label]="org.name"
            >
            </bit-option>
          </bit-select>
        </bit-form-field>
      </div>

      <div class="tw-flex">
        <bit-form-field class="tw-grow">
          <bit-label>{{ "selectCollectionsToAssign" | i18n }}</bit-label>
          <bit-multi-select
            class="tw-w-full"
            formControlName="collections"
            [baseItems]="availableCollections"
            [removeSelectedItems]="true"
            (onItemsConfirmed)="selectCollections($event)"
          ></bit-multi-select>
        </bit-form-field>
      </div>

      <bit-table>
        <ng-container header>
          <td bitCell>{{ "assignToTheseCollections" | i18n }}</td>
          <td bitCell class="tw-w-20"></td>
        </ng-container>
        <ng-template body>
          <tr bitRow *ngFor="let item of selectedCollections; let i = index">
            <td bitCell>
              <i class="bwi bwi-collection" aria-hidden="true"></i>
              {{ item.labelName }}
            </td>
            <td bitCell class="tw-text-right">
              <button
                type="button"
                bitIconButton="bwi-close"
                buttonType="muted"
                appA11yTitle="{{ 'remove' | i18n }} {{ item.labelName }}"
                (click)="unselectCollection(i)"
              ></button>
            </td>
          </tr>
          <tr *ngIf="selectedCollections.length == 0">
            <td bitCell>
              {{ "noCollectionsAssigned" | i18n }}
            </td>
          </tr>
        </ng-template>
      </bit-table>
    </div>

    <ng-container bitDialogFooter>
      <button type="submit" bitButton buttonType="primary" [disabled]="!isValid">
        {{ "assign" | i18n }}
      </button>
      <button type="button" bitButton buttonType="secondary" bitDialogClose>
        {{ "cancel" | i18n }}
      </button>
    </ng-container>
  </bit-dialog>
</form>
