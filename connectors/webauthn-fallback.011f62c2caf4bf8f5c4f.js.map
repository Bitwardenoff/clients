{"version":3,"file":"connectors/webauthn-fallback.011f62c2caf4bf8f5c4f.js","mappings":"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","sources":["webpack://@bitwarden/web-vault/webpack/bootstrap","webpack://@bitwarden/web-vault/webpack/runtime/make namespace object","webpack://@bitwarden/web-vault/./src/connectors/common.ts","webpack://@bitwarden/web-vault/./src/connectors/common-webauthn.ts","webpack://@bitwarden/web-vault/./src/connectors/webauthn-fallback.ts"],"sourcesContent":["// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","export function getQsParam(name: string) {\n  const url = window.location.href;\n  // eslint-disable-next-line\n  name = name.replace(/[\\[\\]]/g, \"\\\\$&\");\n  const regex = new RegExp(\"[?&]\" + name + \"(=([^&#]*)|&|#|$)\");\n  const results = regex.exec(url);\n\n  if (!results) {\n    return null;\n  }\n  if (!results[2]) {\n    return \"\";\n  }\n\n  return decodeURIComponent(results[2].replace(/\\+/g, \" \"));\n}\n\nexport function b64Decode(str: string, spaceAsPlus = false) {\n  if (spaceAsPlus) {\n    str = str.replace(/ /g, \"+\");\n  }\n\n  return decodeURIComponent(\n    Array.prototype.map\n      .call(atob(str), (c: string) => {\n        return \"%\" + (\"00\" + c.charCodeAt(0).toString(16)).slice(-2);\n      })\n      .join(\"\")\n  );\n}\n","export function buildDataString(assertedCredential: PublicKeyCredential) {\n  const response = assertedCredential.response as AuthenticatorAssertionResponse;\n\n  const authData = new Uint8Array(response.authenticatorData);\n  const clientDataJSON = new Uint8Array(response.clientDataJSON);\n  const rawId = new Uint8Array(assertedCredential.rawId);\n  const sig = new Uint8Array(response.signature);\n\n  const data = {\n    id: assertedCredential.id,\n    rawId: coerceToBase64Url(rawId),\n    type: assertedCredential.type,\n    extensions: assertedCredential.getClientExtensionResults(),\n    response: {\n      authenticatorData: coerceToBase64Url(authData),\n      clientDataJson: coerceToBase64Url(clientDataJSON),\n      signature: coerceToBase64Url(sig),\n    },\n  };\n\n  return JSON.stringify(data);\n}\n\nexport function parseWebauthnJson(jsonString: string) {\n  const json = JSON.parse(jsonString);\n\n  const challenge = json.challenge.replace(/-/g, \"+\").replace(/_/g, \"/\");\n  json.challenge = Uint8Array.from(atob(challenge), (c) => c.charCodeAt(0));\n\n  json.allowCredentials.forEach((listItem: any) => {\n    // eslint-disable-next-line\n    const fixedId = listItem.id.replace(/\\_/g, \"/\").replace(/\\-/g, \"+\");\n    listItem.id = Uint8Array.from(atob(fixedId), (c) => c.charCodeAt(0));\n  });\n\n  return json;\n}\n\n// From https://github.com/abergs/fido2-net-lib/blob/b487a1d47373ea18cd752b4988f7262035b7b54e/Demo/wwwroot/js/helpers.js#L34\n// License: https://github.com/abergs/fido2-net-lib/blob/master/LICENSE.txt\nfunction coerceToBase64Url(thing: any) {\n  // Array or ArrayBuffer to Uint8Array\n  if (Array.isArray(thing)) {\n    thing = Uint8Array.from(thing);\n  }\n\n  if (thing instanceof ArrayBuffer) {\n    thing = new Uint8Array(thing);\n  }\n\n  // Uint8Array to base64\n  if (thing instanceof Uint8Array) {\n    let str = \"\";\n    const len = thing.byteLength;\n\n    for (let i = 0; i < len; i++) {\n      str += String.fromCharCode(thing[i]);\n    }\n    thing = window.btoa(str);\n  }\n\n  if (typeof thing !== \"string\") {\n    throw new Error(\"could not coerce to string\");\n  }\n\n  // base64 to base64url\n  // NOTE: \"=\" at the end of challenge is optional, strip it off here\n  thing = thing.replace(/\\+/g, \"-\").replace(/\\//g, \"_\").replace(/=*$/g, \"\");\n\n  return thing;\n}\n","import { b64Decode, getQsParam } from \"./common\";\nimport { buildDataString, parseWebauthnJson } from \"./common-webauthn\";\n\nrequire(\"./webauthn.scss\");\n\nlet parsed = false;\nlet webauthnJson: any;\nlet parentUrl: string = null;\nlet sentSuccess = false;\nlet locale = \"en\";\n\nlet locales: any = {};\n\nfunction parseParameters() {\n  if (parsed) {\n    return;\n  }\n\n  parentUrl = getQsParam(\"parent\");\n  if (!parentUrl) {\n    error(\"No parent.\");\n    return;\n  } else {\n    parentUrl = decodeURIComponent(parentUrl);\n  }\n\n  locale = getQsParam(\"locale\").replace(\"-\", \"_\");\n\n  const version = getQsParam(\"v\");\n\n  if (version === \"1\") {\n    parseParametersV1();\n  } else {\n    parseParametersV2();\n  }\n  parsed = true;\n}\n\nfunction parseParametersV1() {\n  const data = getQsParam(\"data\");\n  if (!data) {\n    error(\"No data.\");\n    return;\n  }\n\n  webauthnJson = b64Decode(data);\n}\n\nfunction parseParametersV2() {\n  let dataObj: { data: any; btnText: string } = null;\n  try {\n    dataObj = JSON.parse(b64Decode(getQsParam(\"data\")));\n  } catch (e) {\n    error(\"Cannot parse data.\");\n    return;\n  }\n\n  webauthnJson = dataObj.data;\n}\n\ndocument.addEventListener(\"DOMContentLoaded\", async () => {\n  parseParameters();\n  try {\n    locales = await loadLocales(locale);\n  } catch {\n    // eslint-disable-next-line\n    console.error(\"Failed to load the locale\", locale);\n    locales = await loadLocales(\"en\");\n  }\n\n  document.getElementById(\"msg\").innerText = translate(\"webAuthnFallbackMsg\");\n  document.getElementById(\"remember-label\").innerText = translate(\"rememberMe\");\n\n  const button = document.getElementById(\"webauthn-button\");\n  button.innerText = translate(\"webAuthnAuthenticate\");\n  button.onclick = start;\n\n  document.getElementById(\"spinner\").classList.add(\"d-none\");\n  const content = document.getElementById(\"content\");\n  content.classList.add(\"d-block\");\n  content.classList.remove(\"d-none\");\n});\n\nasync function loadLocales(newLocale: string) {\n  const filePath = `locales/${newLocale}/messages.json?cache=${process.env.CACHE_TAG}`;\n  const localesResult = await fetch(filePath);\n  return await localesResult.json();\n}\n\nfunction translate(id: string) {\n  return locales[id]?.message || \"\";\n}\n\nfunction start() {\n  if (sentSuccess) {\n    return;\n  }\n\n  if (!(\"credentials\" in navigator)) {\n    error(translate(\"webAuthnNotSupported\"));\n    return;\n  }\n\n  parseParameters();\n  if (!webauthnJson) {\n    error(\"No data.\");\n    return;\n  }\n\n  let json: any;\n  try {\n    json = parseWebauthnJson(webauthnJson);\n  } catch (e) {\n    error(\"Cannot parse data.\");\n    return;\n  }\n\n  initWebAuthn(json);\n}\n\nasync function initWebAuthn(obj: any) {\n  try {\n    const assertedCredential = (await navigator.credentials.get({\n      publicKey: obj,\n    })) as PublicKeyCredential;\n\n    if (sentSuccess) {\n      return;\n    }\n\n    const dataString = buildDataString(assertedCredential);\n    const remember = (document.getElementById(\"remember\") as HTMLInputElement).checked;\n    window.postMessage({ command: \"webAuthnResult\", data: dataString, remember: remember }, \"*\");\n\n    sentSuccess = true;\n    success(translate(\"webAuthnSuccess\"));\n  } catch (err) {\n    error(err);\n  }\n}\n\nfunction error(message: string) {\n  const el = document.getElementById(\"msg\");\n  resetMsgBox(el);\n  el.textContent = message;\n  el.classList.add(\"alert\");\n  el.classList.add(\"alert-danger\");\n}\n\nfunction success(message: string) {\n  (document.getElementById(\"webauthn-button\") as HTMLButtonElement).disabled = true;\n\n  const el = document.getElementById(\"msg\");\n  resetMsgBox(el);\n  el.textContent = message;\n  el.classList.add(\"alert\");\n  el.classList.add(\"alert-success\");\n}\n\nfunction resetMsgBox(el: HTMLElement) {\n  el.classList.remove(\"alert\");\n  el.classList.remove(\"alert-danger\");\n  el.classList.remove(\"alert-success\");\n}\n"],"names":["__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","exports","module","__webpack_modules__","r","Symbol","toStringTag","Object","defineProperty","value","getQsParam","name","url","window","location","href","replace","results","RegExp","exec","decodeURIComponent","b64Decode","str","spaceAsPlus","Array","prototype","map","call","atob","c","charCodeAt","toString","slice","join","coerceToBase64Url","thing","isArray","Uint8Array","from","ArrayBuffer","len","byteLength","i","String","fromCharCode","btoa","Error","webauthnJson","parsed","parentUrl","sentSuccess","locale","locales","parseParameters","error","data","parseParametersV1","dataObj","JSON","parse","e","parseParametersV2","loadLocales","newLocale","filePath","localesResult","fetch","json","translate","id","message","start","navigator","jsonString","challenge","allowCredentials","forEach","listItem","fixedId","parseWebauthnJson","obj","assertedCredential","credentials","get","publicKey","dataString","response","authData","authenticatorData","clientDataJSON","rawId","sig","signature","type","extensions","getClientExtensionResults","clientDataJson","stringify","buildDataString","remember","document","getElementById","checked","postMessage","command","disabled","el","resetMsgBox","textContent","classList","add","success","err","initWebAuthn","remove","addEventListener","console","innerText","button","onclick","content"],"sourceRoot":""}