<div
  class="tw-relative {{
    active && !hideActiveStyles ? 'tw-bg-background-alt4' : 'tw-bg-background-alt3'
  }} {{ fvwStyles$ | async }}"
>
  <div
    [style.--nested-left-padding]="this.treeDepth * 1.5 + 'rem'"
    [style.--base-left-padding]="this.variant === 'tree' ? '2.5rem' : '1rem'"
    class="tw-pl-[calc(var(--base-left-padding)+var(--nested-left-padding))] tw-flex tw-relative tw-items-center tw-pr-4 {{
      variant === 'tree' ? 'tw-py-1' : 'tw-py-2'
    }}"
  >
    <div #slotStart class="[&>*]:!tw-text-sm"><ng-content select="[slot-start]"></ng-content></div>
    <!-- Default content for #slotStart (for consistent sizing) -->
    <div
      *ngIf="slotStart.childElementCount === 0"
      class="{{ variant === 'tree' ? 'tw-px-[.77rem]' : '' }} tw-h-[1.875rem]"
    ></div>

    <ng-container *ngIf="route; then isAnchor; else isButton"></ng-container>

    <!-- Main content of `NavItem` -->
    <ng-template #anchorAndButtonContent>
      <i class="bwi bwi-fw tw-text-white tw-mr-1 {{ icon }}"></i
      ><span [ngClass]="active && !hideActiveStyles ? 'tw-font-bold' : 'tw-font-semibold'">{{
        text
      }}</span>
    </ng-template>

    <!-- Show if a value was passed to `this.to` -->
    <ng-template #isAnchor>
      <!-- The `fvw` class passes focus to `this.focusVisibleWithin$` -->
      <!-- Class field should match `#isButton` class field below -->
      <a
        class="fvw tw-w-full tw-overflow-hidden tw-text-ellipsis tw-whitespace-nowrap tw-border-none tw-bg-transparent tw-p-0 tw-text-start !tw-text-alt2 hover:tw-text-alt2 hover:tw-no-underline focus:tw-outline-none [&>:not(.bwi)]:hover:tw-underline"
        [routerLink]="route"
        routerLinkActive
        [routerLinkActiveOptions]="rlaOptions"
        [ariaCurrentWhenActive]="'page'"
        (isActiveChange)="setActive($event)"
        (click)="mainContentClicked.emit()"
      >
        <ng-container *ngTemplateOutlet="anchorAndButtonContent"></ng-container>
      </a>
    </ng-template>

    <!-- Show if `this.to` is falsy -->
    <ng-template #isButton>
      <!-- Class field should match `#isAnchor` class field above -->
      <button
        class="fvw tw-w-full tw-overflow-hidden tw-text-ellipsis tw-whitespace-nowrap tw-border-none tw-bg-transparent tw-p-0 tw-text-start !tw-text-alt2 hover:tw-text-alt2 hover:tw-no-underline focus:tw-outline-none [&>:not(.bwi)]:hover:tw-underline"
        (click)="mainContentClicked.emit()"
      >
        <ng-container *ngTemplateOutlet="anchorAndButtonContent"></ng-container>
      </button>
    </ng-template>

    <div class="tw-flex tw-gap-1 [&>*]:!tw-text-sm">
      <ng-content select="[slot-end]"></ng-content>
    </div>
  </div>
</div>
