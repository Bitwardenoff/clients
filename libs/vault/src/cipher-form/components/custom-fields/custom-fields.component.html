<ng-template #addTemplate>
  <button
    type="button"
    class="tw-text-primary-600 tw-font-bold tw-flex tw-items-center tw-gap-1"
    bitTypography="body2"
    (click)="openAddEditCustomFieldDialog()"
  >
    <i class="bwi bwi-plus tw-font-bold" aria-hidden="true"></i>
    {{ "addField" | i18n }}
  </button>
</ng-template>

<ng-container *ngIf="!fields?.length">
  <ng-container *ngTemplateOutlet="addTemplate"></ng-container>
</ng-container>

<bit-section *ngIf="fields?.length">
  <bit-section-header>
    <h2 bitTypography="h5">{{ "customFields" | i18n }}</h2>
  </bit-section-header>
  <form [formGroup]="customFieldsForm">
    <bit-card formArrayName="fields" cdkDropList (cdkDropListDropped)="drop($event)">
      <div
        *ngFor="let field of fields.controls; let i = index"
        [formGroupName]="i"
        class="tw-flex tw-py-3 tw-gap-4 tw-bg-background tw-rounded-lg"
        [ngClass]="{ 'tw-items-center': field.value.type === FieldType.Boolean }"
        cdkDrag
      >
        <!-- Text Field -->
        <bit-form-field *ngIf="field.value.type === FieldType.Text" class="tw-flex-1" disableMargin>
          <bit-label>{{ field.value.name }}</bit-label>
          <input bitInput formControlName="value" data-testid="custom-text-field" />
        </bit-form-field>

        <!-- Hidden Field -->
        <bit-form-field
          *ngIf="field.value.type === FieldType.Hidden"
          class="tw-flex-1"
          disableMargin
        >
          <bit-label>{{ field.value.name }}</bit-label>
          <input
            bitInput
            formControlName="value"
            type="password"
            data-testid="custom-hidden-field"
          />
          <button
            type="button"
            bitIconButton
            bitSuffix
            bitPasswordInputToggle
            data-testid="visibility-for-custom-hidden-field"
          ></button>
        </bit-form-field>

        <!-- Boolean Field -->
        <bit-form-control
          *ngIf="field.value.type === FieldType.Boolean"
          class="tw-flex-1"
          disableMargin
        >
          <input
            bitCheckbox
            formControlName="value"
            type="checkbox"
            data-testid="custom-boolean-field"
          />
          <bit-label>{{ field.value.name }}</bit-label>
        </bit-form-control>

        <!-- Linked Field -->
        <bit-form-field
          *ngIf="field.value.type === FieldType.Linked"
          class="tw-flex-1"
          disableMargin
        >
          <bit-label>{{ field.value.name }}</bit-label>
          <bit-select formControlName="linkedId" data-testid="custom-linked-field">
            <bit-option
              *ngFor="let option of linkedFieldOptions"
              [value]="option.value"
              [label]="option.name"
            ></bit-option>
          </bit-select>
        </bit-form-field>

        <button
          type="button"
          (click)="openAddEditCustomFieldDialog({ index: i, label: field.value.name })"
          [appA11yTitle]="'editField' | i18n"
          bitIconButton="bwi-pencil-square"
          class="tw-self-end"
        ></button>

        <button
          type="button"
          bitIconButton="bwi-hamburger"
          class="tw-self-end"
          cdkDragHandle
        ></button>
      </div>

      <ng-container *ngTemplateOutlet="addTemplate"></ng-container>
    </bit-card>
  </form>
</bit-section>
