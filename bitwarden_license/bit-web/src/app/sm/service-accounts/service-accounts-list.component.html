<div *ngIf="!serviceAccounts" class="tw-items-center tw-justify-center tw-pt-64 tw-text-center">
  <i class="bwi bwi-spinner bwi-spin bwi-3x"></i>
</div>

<ng-container *ngIf="serviceAccounts?.length == 0">
  <sm-empty-list
    [secretManagerType]="SecretManagerType.ServiceAccount"
    emptyListTitle="serviceAccountsEmptyListTitle"
    emptyListContent="serviceAccountsEmptyListMessage"
    [showImportSecrets]="false"
  >
  </sm-empty-list>
</ng-container>

<bit-table *ngIf="serviceAccounts?.length >= 1">
  <ng-container header>
    <tr>
      <th bitCell class="tw-w-0">
        <div class="tw-flex tw-w-fit tw-gap-2">
          <input
            type="checkbox"
            (change)="$event ? toggleAll() : null"
            [checked]="selection.hasValue() && isAllSelected()"
            [indeterminate]="selection.hasValue() && !isAllSelected()"
          />
          {{ "all" | i18n }}
        </div>
      </th>
      <th bitCell>{{ "name" | i18n }}</th>
      <th bitCell>{{ "secrets" | i18n }}</th>
      <th bitCell>{{ "lastEdited" | i18n }}</th>
      <th bitCell class="tw-w-0">
        <button
          class="tw-rounded tw-border tw-border-transparent tw-bg-transparent tw-text-main hover:tw-border-secondary-700 focus:tw-border-secondary-700"
          [bitMenuTriggerFor]="tableMenu"
        >
          <i class="bwi bwi-ellipsis-v tw-text-xl" aria-hidden="true"></i>
        </button>
      </th>
    </tr>
  </ng-container>
  <ng-container body>
    <tr bitRow *ngFor="let serviceAccount of serviceAccounts">
      <td bitCell>
        <input
          type="checkbox"
          (change)="$event ? selection.toggle(serviceAccount.id) : null"
          [checked]="selection.isSelected(serviceAccount.id)"
        />
      </td>
      <td bitCell>
        <!-- TODO this needs to be a hyperlink to the service account page-->
        <i class="bwi bwi-wrench tw-text-xl tw-text-muted" aria-hidden="true"></i>
        {{ serviceAccount.name }}
      </td>
      <td bitCell>
        <!-- TODO add number of secrets once mapping is implemented-->
        <span> 0 </span>
      </td>
      <td bitCell>{{ serviceAccount.revisionDate | date: "medium" }}</td>
      <td bitCell>
        <button
          class="tw-rounded tw-border tw-border-transparent tw-bg-transparent tw-text-main hover:tw-border-secondary-700 focus:tw-border-secondary-700"
          [bitMenuTriggerFor]="serviceAccountMenu"
        >
          <i class="bwi bwi-ellipsis-v tw-text-xl" aria-hidden="true"></i>
        </button>
      </td>

      <bit-menu #serviceAccountMenu>
        <button type="button" bitMenuItem (click)="viewServiceAccountEvent.emit(serviceAccount.id)">
          <i class="bwi bwi-fw bwi-eye tw-text-xl" aria-hidden="true"></i>
          {{ "viewServiceAccount" | i18n }}
        </button>
        <button
          type="button"
          bitMenuItem
          (click)="deleteServiceAccountEvent.emit([serviceAccount.id])"
        >
          <i class="bwi bwi-fw bwi-trash tw-text-xl tw-text-danger" aria-hidden="true"></i>
          <span class="tw-text-danger">
            {{ "deleteServiceAccount" | i18n }}
          </span>
        </button>
      </bit-menu>
    </tr>
  </ng-container>
</bit-table>

<bit-menu #tableMenu>
  <button type="button" bitMenuItem (click)="bulkDeleteServiceAccounts()">
    <i class="bwi bwi-fw bwi-trash tw-text-xl tw-text-danger" aria-hidden="true"></i>
    <span class="tw-text-danger">
      {{ "deleteServiceAccounts" | i18n }}
    </span>
  </button>
</bit-menu>
